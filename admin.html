<!DOCTYPE html>
<html>
<head>
<title>Admin - Hypergambling</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: Arial, sans-serif; background: #1a1a1a; color: #ddd; padding: 20px; }
h1 { text-align: center; margin-bottom: 20px; color: #ff0000; font-family: 'Courier New', monospace; }

/* Top toolbar */
.toolbar { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
.toolbar button { padding: 10px 20px; font-size: 14px; font-weight: bold; border: none; border-radius: 4px; cursor: pointer; }
.btn-export { background: #e63946; color: #fff; }
.btn-export:hover { background: #c1121f; }
.btn-import { background: #457b9d; color: #fff; }
.btn-import:hover { background: #1d3557; }
.btn-save { background: #2a9d8f; color: #fff; }
.btn-save:hover { background: #264653; }

/* Two-column layout */
.columns { display: flex; gap: 20px; align-items: flex-start; }
.column-left { flex: 1; min-width: 0; }
.column-right { width: 400px; flex-shrink: 0; }

/* Add entry form */
.add-form { background: #2a2a2a; padding: 16px; border-radius: 6px; margin-bottom: 20px; }
.add-form h2 { margin-bottom: 12px; font-size: 16px; color: #e63946; }
.add-form label { display: block; margin-bottom: 4px; font-size: 13px; color: #aaa; }
.add-form select, .add-form input, .add-form textarea {
  width: 100%; padding: 8px; margin-bottom: 10px; background: #333; color: #ddd;
  border: 1px solid #555; border-radius: 4px; font-size: 14px; font-family: Arial, sans-serif;
}
.add-form textarea { height: 80px; resize: vertical; }
.add-form button { padding: 8px 16px; background: #e63946; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
.add-form button:hover { background: #c1121f; }

/* Entry list */
.entry-list { list-style: none; }
.entry-item {
  background: #333; border: 1px solid #444; border-radius: 4px; margin-bottom: 6px;
  padding: 10px 12px; display: flex; align-items: center; gap: 10px; cursor: grab;
  transition: background 0.15s;
}
.entry-item:active { cursor: grabbing; }
.entry-item.dragging { opacity: 0.4; background: #222; }
.entry-item.drag-over { border-top: 3px solid #e63946; }
.entry-item .grip { color: #666; font-size: 18px; flex-shrink: 0; user-select: none; }
.entry-item .info { flex: 1; min-width: 0; overflow: hidden; }
.entry-item .type-badge {
  display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 11px;
  font-weight: bold; text-transform: uppercase; margin-right: 6px; flex-shrink: 0;
}
.type-text .type-badge { background: #457b9d; }
.type-image .type-badge { background: #2a9d8f; }
.type-video .type-badge { background: #e9c46a; color: #333; }
.type-link .type-badge { background: #e76f51; }
.entry-item .preview-text {
  font-size: 12px; color: #999; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.entry-item .edit-btn, .entry-item .delete-btn {
  background: none; border: none; color: #888; font-size: 18px; cursor: pointer;
  padding: 4px 8px; border-radius: 3px; flex-shrink: 0;
}
.entry-item .edit-btn:hover { color: #2a9d8f; background: #444; }
.entry-item .delete-btn:hover { color: #e63946; background: #444; }
.add-form .btn-cancel { background: #666; margin-left: 8px; }
.add-form .btn-cancel:hover { background: #555; }
.add-form.editing { border: 2px solid #2a9d8f; }

/* Preview pane */
.preview-pane { background: #ff0000; padding: 25px; border-radius: 6px; }
.preview-pane h2 { text-align: center; color: #fff; font-family: 'Courier New', monospace; margin-bottom: 12px; font-size: 16px; }
.preview-content table { width: 100%; border-collapse: collapse; border-spacing: 0; }
.preview-content img { width: 100%; height: auto; display: block; }
.preview-content video { width: 100%; height: auto; display: block; }
.preview-content a { color: #ddd; text-decoration: underline; }
.preview-content a:hover { color: #ffff00; }
.preview-content td.divider { height: 2px; font-size: 0; line-height: 0; }

/* Responsive */
@media (max-width: 900px) {
  .columns { flex-direction: column; }
  .column-right { width: 100%; }
}
</style>
</head>
<body>

<h1>HYPERGAMBLING ADMIN</h1>

<div class="toolbar">
  <button class="btn-export" onclick="exportJS()">Export entries.js</button>
  <button class="btn-import" onclick="document.getElementById('importFile').click()">Import entries.js</button>
  <input type="file" id="importFile" accept=".js,.json" style="display:none" onchange="importFile(event)">
  <button class="btn-save" onclick="saveToLocal()">Save to Browser</button>
</div>

<div class="columns">
  <div class="column-left">
    <!-- Add form -->
    <div class="add-form">
      <h2>Add Entry</h2>
      <label>Type</label>
      <select id="entryType" onchange="updateFormFields()">
        <option value="text">Text</option>
        <option value="image">Image</option>
        <option value="video">Video</option>
        <option value="link">Link</option>
      </select>
      <div id="formFields"></div>
      <button id="formSubmitBtn" onclick="submitEntry()">Add Entry</button>
      <button class="btn-cancel" id="formCancelBtn" onclick="cancelEdit()" style="display:none">Cancel</button>
    </div>

    <!-- Entry list -->
    <ul class="entry-list" id="entryList"></ul>
  </div>

  <div class="column-right">
    <div class="preview-pane">
      <h2>LIVE PREVIEW</h2>
      <div class="preview-content" id="previewContent"></div>
    </div>
  </div>
</div>

<script>
var entries = [];
var dragIndex = null;
var editingIndex = null;

// --- Init ---
(function init() {
  var saved = localStorage.getItem('hypergambling_entries');
  if (saved) {
    try { entries = JSON.parse(saved); } catch(e) { entries = []; }
  }
  updateFormFields();
  render();
})();

// --- Form fields ---
function updateFormFields() {
  var type = document.getElementById('entryType').value;
  var container = document.getElementById('formFields');
  var html = '';
  if (type === 'text') {
    html = '<label>Content</label><textarea id="fieldContent" placeholder="Enter text content..."></textarea>';
  } else if (type === 'image') {
    html = '<label>Image Path</label><input id="fieldSrc" placeholder="content/img.png">';
  } else if (type === 'video') {
    html = '<label>Video Path</label><input id="fieldSrc" placeholder="content/vid.mp4">';
  } else if (type === 'link') {
    html = '<label>Title</label><input id="fieldTitle" placeholder="LINK TITLE">';
    html += '<label>Description</label><input id="fieldDesc" placeholder="A short description">';
    html += '<label>URL</label><input id="fieldUrl" placeholder="https://example.com">';
  }
  container.innerHTML = html;
}

// --- Build entry from form ---
function buildEntryFromForm() {
  var type = document.getElementById('entryType').value;
  var entry = { type: type };

  if (type === 'text') {
    var content = document.getElementById('fieldContent').value.trim();
    if (!content) return null;
    entry.content = content;
  } else if (type === 'image' || type === 'video') {
    var src = document.getElementById('fieldSrc').value.trim();
    if (!src) return null;
    entry.src = src;
  } else if (type === 'link') {
    var title = document.getElementById('fieldTitle').value.trim();
    var desc = document.getElementById('fieldDesc').value.trim();
    var url = document.getElementById('fieldUrl').value.trim();
    if (!title || !url) return null;
    entry.title = title;
    entry.description = desc;
    entry.url = url;
  }
  return entry;
}

// --- Submit (add or save edit) ---
function submitEntry() {
  var entry = buildEntryFromForm();
  if (!entry) return;

  if (editingIndex !== null) {
    entries[editingIndex] = entry;
    cancelEdit();
  } else {
    entries.push(entry);
    updateFormFields();
  }
  render();
}

// --- Edit entry ---
function editEntry(index) {
  var entry = entries[index];
  editingIndex = index;

  var select = document.getElementById('entryType');
  select.value = entry.type;
  select.disabled = true;
  updateFormFields();

  if (entry.type === 'text') {
    document.getElementById('fieldContent').value = entry.content;
  } else if (entry.type === 'image' || entry.type === 'video') {
    document.getElementById('fieldSrc').value = entry.src;
  } else if (entry.type === 'link') {
    document.getElementById('fieldTitle').value = entry.title;
    document.getElementById('fieldDesc').value = entry.description || '';
    document.getElementById('fieldUrl').value = entry.url;
  }

  document.getElementById('formSubmitBtn').textContent = 'Save Edit';
  document.getElementById('formCancelBtn').style.display = 'inline-block';
  document.querySelector('.add-form h2').textContent = 'Edit Entry';
  document.querySelector('.add-form').classList.add('editing');
}

// --- Cancel edit ---
function cancelEdit() {
  editingIndex = null;
  var select = document.getElementById('entryType');
  select.disabled = false;
  updateFormFields();
  document.getElementById('formSubmitBtn').textContent = 'Add Entry';
  document.getElementById('formCancelBtn').style.display = 'none';
  document.querySelector('.add-form h2').textContent = 'Add Entry';
  document.querySelector('.add-form').classList.remove('editing');
}

// --- Delete entry ---
function deleteEntry(index) {
  entries.splice(index, 1);
  render();
}

// --- Drag and drop ---
function onDragStart(e, index) {
  dragIndex = index;
  e.currentTarget.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
}

function onDragEnd(e) {
  dragIndex = null;
  e.currentTarget.classList.remove('dragging');
  var items = document.querySelectorAll('.entry-item');
  for (var i = 0; i < items.length; i++) items[i].classList.remove('drag-over');
}

function onDragOver(e, index) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
  var items = document.querySelectorAll('.entry-item');
  for (var i = 0; i < items.length; i++) items[i].classList.remove('drag-over');
  if (dragIndex !== null && dragIndex !== index) {
    e.currentTarget.classList.add('drag-over');
  }
}

function onDrop(e, index) {
  e.preventDefault();
  if (dragIndex === null || dragIndex === index) return;
  var moved = entries.splice(dragIndex, 1)[0];
  entries.splice(index, 0, moved);
  dragIndex = null;
  render();
}

// --- Render ---
function render() {
  renderList();
  renderPreview();
}

function escapeHTML(str) {
  var div = document.createElement('div');
  div.appendChild(document.createTextNode(str));
  return div.innerHTML;
}

function entryLabel(entry) {
  if (entry.type === 'text') return entry.content.length > 80 ? entry.content.substring(0, 80) + '...' : entry.content;
  if (entry.type === 'image') return entry.src;
  if (entry.type === 'video') return entry.src;
  if (entry.type === 'link') return entry.title + ' - ' + entry.url;
  return '';
}

function renderList() {
  var list = document.getElementById('entryList');
  var html = '';
  for (var i = 0; i < entries.length; i++) {
    var entry = entries[i];
    html += '<li class="entry-item type-' + entry.type + '" draggable="true"';
    html += ' ondragstart="onDragStart(event,' + i + ')"';
    html += ' ondragend="onDragEnd(event)"';
    html += ' ondragover="onDragOver(event,' + i + ')"';
    html += ' ondrop="onDrop(event,' + i + ')">';
    html += '<span class="grip">&#9776;</span>';
    html += '<span class="type-badge">' + entry.type + '</span>';
    html += '<span class="info"><span class="preview-text">' + escapeHTML(entryLabel(entry)) + '</span></span>';
    html += '<button class="edit-btn" onclick="editEntry(' + i + ')" title="Edit">&#9998;</button>';
    html += '<button class="delete-btn" onclick="deleteEntry(' + i + ')" title="Delete">&times;</button>';
    html += '</li>';
  }
  list.innerHTML = html;
}

function needsDivider(prevType, currType) {
  var d = ['text', 'link'];
  return d.indexOf(prevType) !== -1 && d.indexOf(currType) !== -1;
}

function renderPreview() {
  var container = document.getElementById('previewContent');
  var html = '';
  var prevType = null;

  for (var i = 0; i < entries.length; i++) {
    var entry = entries[i];

    if (prevType !== null && needsDivider(prevType, entry.type)) {
      html += '<table width="100%" cellpadding="0" cellspacing="0"><tr><td class="divider" bgcolor="#000000"></td></tr></table>';
    }

    if (entry.type === 'text') {
      html += '<table width="100%" cellpadding="8" cellspacing="0">';
      html += '<tr><td bgcolor="#333333">';
      html += '<font face="Arial" size="-1" color="#DDDDDD">';
      html += '<b>' + escapeHTML(entry.content).replace(/\n/g, '<br>') + '</b>';
      html += '</font></td></tr></table>';
    } else if (entry.type === 'image') {
      html += '<img src="' + escapeHTML(entry.src) + '" style="pointer-events:auto;">';
    } else if (entry.type === 'video') {
      html += '<table width="100%" cellpadding="0" cellspacing="0">';
      html += '<tr><td bgcolor="#000000" align="center">';
      html += '<video controls width="100%"><source src="' + escapeHTML(entry.src) + '" type="video/mp4"></video>';
      html += '</td></tr></table>';
    } else if (entry.type === 'link') {
      html += '<table width="100%" cellpadding="8" cellspacing="0">';
      html += '<tr><td bgcolor="#333333" align="center">';
      html += '<font face="Arial" color="#DDDDDD" size="+1"><b>';
      html += '<a href="' + escapeHTML(entry.url) + '">' + escapeHTML(entry.title) + '</a>';
      html += '</b></font>';
      html += '<font face="Arial" size="-1" color="#DDDDDD"><br>';
      html += '<b>' + escapeHTML(entry.description) + '</b>';
      html += '</font></td></tr></table>';
    }

    prevType = entry.type;
  }

  container.innerHTML = html;
}

// --- Export ---
function exportJS() {
  var json = JSON.stringify(entries, null, 2);
  var content = 'var ENTRIES_DATA = ' + json + ';\n';
  var blob = new Blob([content], { type: 'application/javascript' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = 'entries.js';
  a.click();
  URL.revokeObjectURL(url);
}

// --- Import ---
function importFile(event) {
  var file = event.target.files[0];
  if (!file) return;
  var reader = new FileReader();
  reader.onload = function(e) {
    var text = e.target.result;
    try {
      // Try parsing as .js format first (var ENTRIES_DATA = [...];)
      var match = text.match(/var\s+ENTRIES_DATA\s*=\s*([\s\S]*?);?\s*$/);
      var data;
      if (match) {
        data = JSON.parse(match[1]);
      } else {
        // Fall back to plain JSON
        data = JSON.parse(text);
      }
      if (Array.isArray(data)) {
        entries = data;
        render();
      } else {
        alert('Invalid file: expected an array.');
      }
    } catch(err) {
      alert('Failed to parse file: ' + err.message);
    }
  };
  reader.readAsText(file);
  event.target.value = '';
}

// --- Save to localStorage ---
function saveToLocal() {
  localStorage.setItem('hypergambling_entries', JSON.stringify(entries));
  alert('Saved to browser storage.');
}
</script>
</body>
</html>
